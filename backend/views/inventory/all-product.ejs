<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/stylesheets/basic.css">
  <link rel="stylesheet" href="/stylesheets/all-prodcuts.css">
  <link rel="stylesheet" href="/stylesheets/common.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

  <%- include('../common/side-menu.ejs') %>
  <section class="home-section">
    <nav class="navbar">
      <i class="fa-solid fa-bars"></i>
      <%- include('../common/navbar.ejs') %>
    </nav>

    <p class="page-details"><%= header %></p>

    <section class="body">
      <% if (products && products.length > 0) { %>
        <table class="product-table">
          <thead>
            <tr>
              <th onclick="sortTable(0)">Name</th>
              <th onclick="sortTable(1)">HSN</th>
              <th onclick="sortTable(2)">GST</th>
              <th onclick="sortTable(3)">Purchase Rate</th>
              <th onclick="sortTable(4)">Sale Rate</th>
              <th onclick="sortTable(5)">Action</th>
            </tr>
          </thead>
          <tbody>
            <% products.forEach(product => { %>
              <tr>
                <td><%= product.name %></td>
                <td><%= product.hsn %></td>
                <td><%= product.gst %></td>
                <td><%= product.purchaserate.toFixed(2) %></td>
                <td><%= product.salerate.toFixed(2) %></td>
                <td>
                  <% if(product.batches && product.batches.length > 0) { %>
                    <button onclick="showBatchDetails('<%= product.name %>', <%= JSON.stringify(product.batches) %>)">Show Batches</button>
                  <% } else { %>
                    No batches available
                  <% } %>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
    
        <div class="overlay" id="overlay"></div>
        <div class="batch-details" id="batchDetails">
          <h2 id="batchProductName"></h2>
          <table id="batchList">
            <thead>
              <tr>
                <th>Batch</th>
                <th>Quantity</th>
                <th>Exipre Date</th>
                <th>Packaging</th>
                <th>MRP</th>
              </tr>
            </thead>
            <tbody id="tbody-batch">
            </tbody>
          </table>
          <button onclick="closeBatchDetails()">Close</button>
        </div>
      <% } else { %>
        <p>No products available.</p>
      <% } %>
    </section>
  
 </section>

<script>
    function showBatchDetails(productName, batches) {
      const body = document.body;
      const overlay = document.getElementById('overlay');
      const batchDetails = document.getElementById('batchDetails');
      const batchProductName = document.getElementById('batchProductName');
      const tbody = document.getElementById('tbody-batch');
  
      body.classList.add('no-scroll');
  
      batchProductName.textContent = `Batches for ${productName}`;
      tbody.innerHTML = '';
  
      batches.forEach(batch => {
        if (batch) {
          const tableRow = document.createElement('tr');
  
          // Create table cells for each property
          const batchCell = document.createElement('td');
          batchCell.textContent = batch.batch;
  
          const quantityCell = document.createElement('td');
          quantityCell.textContent = batch.quantity;
  
          const expireDateCell = document.createElement('td');
          expireDateCell.textContent = new Date(batch.expireDate).toISOString().split('T')[0];
  
          const packagingCell = document.createElement('td');
          packagingCell.textContent = batch.packaging;
  
          const mrpCell = document.createElement('td');
          mrpCell.textContent = batch.mrp;
  
          // Append cells to the table row
          tableRow.appendChild(batchCell);
          tableRow.appendChild(quantityCell);
          tableRow.appendChild(expireDateCell);
          tableRow.appendChild(packagingCell);
          tableRow.appendChild(mrpCell);
  
          // Append the table row to the table
          tbody.appendChild(tableRow);
        }
      });
  
      overlay.style.display = 'block';
      batchDetails.style.display = 'block';
    }
  
    function closeBatchDetails() {
      const body = document.body;
      const overlay = document.getElementById('overlay');
      const batchDetails = document.getElementById('batchDetails');
  
      body.classList.remove('no-scroll');
  
      overlay.style.display = 'none';
      batchDetails.style.display = 'none';
    }
</script>
  
</body>
<script src="/scripts/side-menu.js"></script>
<script src="/scripts/sort-table.js"></script>
</html>
