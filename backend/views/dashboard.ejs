<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice and Inventory Dashboard</title>
    <link rel="stylesheet" href="/stylesheets/basic.css">
    <link rel="stylesheet" href="/stylesheets/common.css">
    <link rel="stylesheet" href="/stylesheets/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <%- include('./common/side-menu.ejs') %>
    <section class="home-section">
        <nav class="navbar">
          <i class="fa-solid fa-bars"></i>
          <%- include('./common/navbar.ejs') %>
        </nav>

        <p class="page-details"><%= header %></p>

        <section class="body">
            <div class="small-card-container">
                    <div class="small-card">
                        <h2>Total Invoices</h2>
                        <p><%= invoices.length %></p>
                    </div>  
                    <div class="small-card">
                        <h2>Total Products</h2>
                        <p><%= products.length %></p>
                    </div>
            </div>

            <div class="medium-card-container">
                <div class="medium-card">
                    <h4>Last Invoice</h4>
                    <div class="card-data">
                        <p><%= lastInvoice.invoiceNumber %></p>
                        <p><%= lastInvoice.customerName %></p>
                        <p><%= lastInvoice.type %></p>
                        <p><%= new Date(lastInvoice.date).toLocaleString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %></p>
                        <p><a href="/invoices/<%=lastInvoice._id%>">Get Pdf</a></p>
                    </div>
                </div>
                <div class="medium-card">

                </div>
            </div>

            <div class="big-card-container">
                <div class="big-card">
                    <h3>High Stock</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Product Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% productsForStock.forEach((product) => { %>
                                <% if (product.quantity >= 500) { %>
                                    <tr>
                                        <td><%= product.name %></td>
                                        <td><%= product.quantity %></td>
                                    </tr>
                                <% } %>
                            <% }); %>
                        </tbody>
                    </table>
                </div> 
                <div class="big-card">
                    <h3>Near Exipre</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Product Batch</th>
                                <th>Quantity</th>
                                <th>Exipre Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% productsForExipre.forEach((product) => { %>
                                    <tr>
                                        <td><%= product.name %></td>
                                        <td><%= product.batch.name %></td>
                                        <td><%= product.batch.quantity %></td>
                                        <td><%= product.batch.expire.getMonth() + 1 %>/<%= product.batch.expire.getFullYear() %></td>
                                    </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>               
            </div>

        </section>
    </section>
</body>
<script src="scripts/side-menu.js">
</script>
</html>
