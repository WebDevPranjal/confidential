<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %></title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }

    th {
      background-color: #f2f2f2;
    }

    .batch-details {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 1;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
  </style>
</head>
<body>

  <h1><%= pageTitle %></h1>

  <% if (products && products.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>HSN</th>
          <th>GST</th>
          <th>Purchase Rate</th>
          <th>Sale Rate</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(product => { %>
          <tr>
            <td><%= product.name %></td>
            <td><%= product.hsn %></td>
            <td><%= product.gst %></td>
            <td><%= product.purchaserate.toFixed(2) %></td>
            <td><%= product.salerate.toFixed(2) %></td>
            <td>
              <% if(product.batches && product.batches.length > 0) { %>
                <button onclick="showBatchDetails('<%= product.name %>', <%= JSON.stringify(product.batches) %>)">Show Batches</button>
              <% } else { %>
                No batches available
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>

    <div class="overlay" id="overlay"></div>
    <div class="batch-details" id="batchDetails">
      <h2 id="batchProductName"></h2>
      <ul id="batchList"></ul>
      <button onclick="closeBatchDetails()">Close</button>
    </div>
  <% } else { %>
    <p>No products available.</p>
  <% } %>

  <script>
    function showBatchDetails(productName, batches) {
      const overlay = document.getElementById('overlay');
      const batchDetails = document.getElementById('batchDetails');
      const batchProductName = document.getElementById('batchProductName');
      const batchList = document.getElementById('batchList');

      batchProductName.textContent = `Batches for ${productName}`;
      batchList.innerHTML = '';

      batches.forEach(batch => {
        if (batch) {
          const listItem = document.createElement('li');
          listItem.textContent = `Batch: ${batch.batch}, Quantity: ${batch.quantity}, Packaging: ${batch.packaging}, Expire Date: ${new Date(batch.expireDate).toISOString().split('T')[0]}, MRP: ${batch.mrp}`;
          batchList.appendChild(listItem);
        }
      });

      overlay.style.display = 'block';
      batchDetails.style.display = 'block';
    }

    function closeBatchDetails() {
      const overlay = document.getElementById('overlay');
      const batchDetails = document.getElementById('batchDetails');

      overlay.style.display = 'none';
      batchDetails.style.display = 'none';
    }
  </script>

</body>
</html>
